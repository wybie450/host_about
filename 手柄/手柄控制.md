# 手柄控制

[手柄] → /joy → [teleop_twist_joy] → /cmd_vel → [机器人底盘控制节点]

你列出的这几个头文件分别来自不同的库，它们各自提供了不同的功能。下面我会逐一解释它们的作用：

![image-20250714175425686](/home/wybie/dailywork/笔记/ROS/ROS2项目学习.assets/image-20250714175425686.png)

![image-20250719195927100](/home/wybie/dailywork/笔记/ROS/ROS2项目学习.assets/image-20250719195927100.png)

------

## 1. `#include <geometry_msgs/msg/twist.hpp>`

### 所属库：ROS2（`geometry_msgs`）

### 作用：

- 这是 **ROS2（Robot Operating System 2）** 中的一个消息类型定义文件。
- `geometry_msgs/msg/Twist` 是一个标准的 ROS2 消息类型，用于表示**速度指令**，通常用于控制机器人的运动。

### 具体内容：

`Twist` 消息包含两个主要部分：

- `linear`：表示线速度（单位：米/秒），是一个三维向量（x, y, z），描述机器人在三个方向上的移动速度。
- `angular`：表示角速度（单位：弧度/秒），也是一个三维向量（x, y, z），描述机器人绕三个轴的旋转速度。

### 典型用途：

- 在 ROS2 中控制移动机器人（如 TurtleBot、AGV 等）的运动。
- 发布速度指令到 `/cmd_vel` 这类话题，让机器人按照指定的线速度和角速度移动。

------

## 2. `#include <termios.h>`

### 所属库：POSIX 标准库（Linux/Unix 系统）

### 作用：

- 这是 **POSIX 标准**定义的一个头文件，用于**控制终端（Terminal）的输入输出行为**。
- 主要用于配置终端的属性，比如设置输入模式（是否回显、是否缓冲等）、读取键盘输入等。

### 具体功能：

- 通过

   

  ```
  struct termios
  ```

   

  结构体，可以配置终端的各种属性，例如：

  - 是否启用回显（Echo）：用户输入的内容是否显示在屏幕上。
  - 是否启用规范模式（Canonical Mode）：是否按行缓冲输入（即按下回车才读取输入）。
  - 设置输入/输出的波特率（Baud Rate）等。

### 典型用途：

- 在 Linux/Unix 终端程序中实现**非阻塞键盘输入**（比如实时读取按键，而不需要按回车）。
- 控制串口通信（Serial Communication）的终端行为（虽然串口通信更多用 `fcntl.h` 和 `unistd.h`）。

------

## 3. `#include <fcntl.h>`

### 所属库：POSIX 标准库（Linux/Unix 系统）

### 作用：

- 这是 **POSIX 标准**定义的一个头文件，用于**文件控制（File Control）**操作。
- 主要用于操作文件描述符（File Descriptor），比如设置文件的打开方式、控制 I/O 行为等。

### 具体功能：

- 提供了一些重要的函数和标志，例如：
  - `open()`：打开文件或设备（如串口设备 `/dev/ttyUSB0`）。
  - `fcntl()`：对文件描述符进行控制（如设置非阻塞模式、修改文件状态标志等）。
  - 定义了一些标志常量，比如：
    - `O_RDONLY`：只读模式打开文件。
    - `O_WRONLY`：只写模式打开文件。
    - `O_RDWR`：读写模式打开文件。
    - `O_NONBLOCK`：设置非阻塞模式（Non-blocking Mode）。

### 典型用途：

- 打开并控制设备文件（如串口 `/dev/ttyUSB0` 或 `/dev/ttyACM0`）。
- 设置文件描述符为**非阻塞模式**，以便程序可以立即返回，而不用等待 I/O 操作完成。

------

## 4. `#include <unistd.h>`

### 所属库：POSIX 标准库（Linux/Unix 系统）

### 作用：

- 这是 **POSIX 标准**定义的一个头文件，提供了许多**系统级的基础函数**，用于进程控制、文件操作、I/O 控制等。
- 是 Unix/Linux 系统编程中最常用的头文件之一。

### 具体功能：

- 提供了许多重要的函数，例如：
  - `read()`：从文件描述符中读取数据。
  - `write()`：向文件描述符中写入数据。
  - `close()`：关闭文件描述符。
  - `usleep()`：让进程暂停执行一段微秒级的时间（已过时，推荐用 `nanosleep()`）。
  - `sleep()`：让进程暂停执行一段秒级的时间。
  - `getpid()`：获取当前进程的 PID。
  - `fork()`：创建子进程。
  - `chdir()`：改变当前工作目录。

### 典型用途：

- 在 Linux/Unix 系统中进行**文件读写操作**（如操作串口设备）。
- 进行**进程管理**（如创建子进程）。

控制**I/O 行为**（如读取键盘输入、写入数据到设备等）。

###### ✴

![image-20250706204052279](/home/wybie/dailywork/笔记/ROS/ROS2项目学习.assets/image-20250706204052279.png)

#### rqt逻辑

![image-20250707161936654](/home/wybie/dailywork/笔记/ROS/ROS2项目学习.assets/image-20250707161936654.png)

![[002] ROS+罗技F710游戏手柄，实现小车遥控控制_ros2 joy f710-CSDN博客](https://img-blog.csdnimg.cn/20190709145353472.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3loeHhoeTk3OA==,size_16,color_FFFFFF,t_70)

## **如何配置按钮和轴映射？**

### **(1) 通过命令行参数配置**

启动节点时，可以动态指定按钮和轴的索引：

bash

复制

```
ros2 run your_package joystick_to_cmdvel \
    --ros-args \
    -p slow_mode_button:=1 \          # 慢速模式按钮=1（第二个按钮）
    -p axis_linear_x:=4 \             # 纵向摇杆轴索引=4
    -p axis_linear_y:=3 \             # 横向摇杆轴索引=3
    -p axis_angular:=2                # 角速度摇杆轴索引=2
```

### **(2) 通过 Launch 文件配置**

在 ROS 2 的 launch 文件中，可以这样配置：

xml

复制

```
<node name="joystick_cmdvel_node" pkg="your_package" exec="joystick_to_cmdvel">
    <param name="slow_mode_button" value="1"/>
    <param name="axis_linear_x" value="4"/>
    <param name="axis_linear_y" value="3"/>
    <param name="axis_angular" value="2"/>
</node>
```

json:https://blog.csdn.net/Jason_WSYCY/article/details/124380273

joystick:https://blog.csdn.net/zbw1185/article/details/121023854

## /cmd_vel和/joy的区别?

|     **特性**     |             `/cmd_vel`             |              `/joy`               |
| :--------------: | :--------------------------------: | :-------------------------------: |
|     **用途**     |         直接控制机器人运动         |       接收手柄原始输入数据        |
|   **消息类型**   |       `geometry_msgs/Twist`        |         `sensor_msgs/Joy`         |
|   **数据内容**   |    线速度 + 角速度（物理单位）     | 摇杆轴值 + 按键状态（无物理单位） |
|    **发布者**    | 决策节点（如导航栈、手柄映射节点） |    手柄驱动节点（如 `joy` 包）    |
|    **订阅者**    |            底盘驱动节点            |   手柄映射节点、自定义决策节点    |
| **是否直接控制** |       **是**（底层控制指令）       |   **否**（输入源，需二次处理）    |